# AI Proxy é¡¹ç›®æ¶æ„æ–‡æ¡£

> **æ–‡æ¡£ç‰ˆæœ¬**: 1.0
> **æ›´æ–°æ—¥æœŸ**: 2025-12-20

---

## ğŸ“Š é¡¹ç›®æ¦‚è§ˆ

| ç»´åº¦ | è¯´æ˜ |
|------|------|
| **é¡¹ç›®å®šä½** | ä¼ä¸šçº§ AI ç½‘å…³ä»£ç† |
| **ä»£ç è§„æ¨¡** | 389 ä¸ª Go æ–‡ä»¶ï¼Œçº¦ 85K è¡Œä»£ç  |
| **æ ¸å¿ƒè¯­è¨€** | Go 1.25.5 + React |
| **æ•°æ®åº“** | PostgreSQL/MySQL/SQLite (ä¼˜å…ˆ PostgreSQL) |
| **ç¼“å­˜** | Redis + å†…å­˜åŒå±‚ç¼“å­˜ |
| **Web æ¡†æ¶** | Gin |
| **æ¶æ„é£æ ¼** | é€‚é…å™¨ + æ’ä»¶æ¨¡å¼ |
| **éƒ¨ç½²æ–¹å¼** | Docker/K8s/äºŒè¿›åˆ¶ |
| **å‰ç«¯æŠ€æœ¯** | React + Vite |

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Client (OpenAI Compatible)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           Router Layer (Gin)                            â”‚
â”‚  /v1/chat/completions  /v1/embeddings  /v1/audio/*  /v1/images/*       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Middleware Chain                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚IPBlock â”‚â†’ â”‚TokenAuth â”‚â†’ â”‚Distributeâ”‚â†’ â”‚ReqID   â”‚â†’ â”‚CORS      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Controller Layer (relay.go)                         â”‚
â”‚                   NewRelay(mode) â†’ Handle(c *gin.Context)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Meta Context Builder                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ Meta {                                                        â”‚      â”‚
â”‚  â”‚   Channel, Group, Token, ModelConfig                         â”‚      â”‚
â”‚  â”‚   RequestID, Endpoint, Mode, OriginModel, ActualModel        â”‚      â”‚
â”‚  â”‚   RequestTimeout, RequestAt                                  â”‚      â”‚
â”‚  â”‚ }                                                             â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Adaptor Selection Engine                           â”‚
â”‚  GetAdaptor(channelType) â†’ Adaptor Interface                           â”‚
â”‚                                                                          â”‚
â”‚  [40+ Adaptors]                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚OpenAI  â”‚ â”‚Azure   â”‚ â”‚Claude  â”‚ â”‚Gemini  â”‚ â”‚Baidu   â”‚ â”‚Alibaba â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚Tencent â”‚ â”‚DeepSeekâ”‚ â”‚Coze    â”‚ â”‚Vertex  â”‚ â”‚Bedrock â”‚ â”‚...35+  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           Plugin Chain                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚Cache     â”‚â†’ â”‚WebSearch â”‚â†’ â”‚ThinkSplitâ”‚â†’ â”‚Patch     â”‚â†’ â”‚Monitor   â”‚â”‚
â”‚  â”‚Plugin    â”‚  â”‚Plugin    â”‚  â”‚Plugin    â”‚  â”‚Plugin    â”‚  â”‚Plugin    â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                          â”‚
â”‚  WrapperAdaptor(adaptor, plugins...)                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Adaptor Processing Pipeline                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ 1. GetRequestURL()        â†’ æ„å»ºç›®æ ‡ URL                      â”‚     â”‚
â”‚  â”‚ 2. SetupRequestHeader()   â†’ è®¾ç½®è®¤è¯å¤´å’Œè‡ªå®šä¹‰å¤´              â”‚     â”‚
â”‚  â”‚ 3. ConvertRequest()       â†’ è¯·æ±‚æ ¼å¼è½¬æ¢ (OpenAIâ†’Provider)    â”‚     â”‚
â”‚  â”‚ 4. DoRequest()            â†’ HTTP è¯·æ±‚å‘é€                      â”‚     â”‚
â”‚  â”‚ 5. DoResponse()           â†’ å“åº”è§£æå’Œ Token è®¡ç®—             â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          Response Renderer                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚OpenAI    â”‚  â”‚Claude    â”‚  â”‚Gemini    â”‚  â”‚Common    â”‚              â”‚
â”‚  â”‚SSE       â”‚  â”‚Event     â”‚  â”‚SSE       â”‚  â”‚JSON      â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                          â”‚
â”‚  - æµå¼: SSE (Server-Sent Events)                                      â”‚
â”‚  - éæµå¼: JSON                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Usage Tracking & Billing                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ 1. è®°å½•è¯·æ±‚æ—¥å¿— (Log è¡¨)                                  â”‚        â”‚
â”‚  â”‚ 2. è®¡ç®— Token ä½¿ç”¨é‡                                       â”‚        â”‚
â”‚  â”‚    - Input Tokens, Output Tokens                          â”‚        â”‚
â”‚  â”‚    - Cached Tokens (if applicable)                        â”‚        â”‚
â”‚  â”‚    - Reasoning Tokens (if applicable)                     â”‚        â”‚
â”‚  â”‚ 3. è®¡ç®—æˆæœ¬                                                â”‚        â”‚
â”‚  â”‚    - åŸºç¡€ä»·æ ¼ (ModelConfig)                                â”‚        â”‚
â”‚  â”‚    - åˆ†ç»„å®šä»·è¦†ç›– (GroupModelConfig)                       â”‚        â”‚
â”‚  â”‚    - ç¼“å­˜ Token ä¼˜æƒ                                        â”‚        â”‚
â”‚  â”‚    - æ¨ç† Token åŠ ä»·                                       â”‚        â”‚
â”‚  â”‚ 4. æ›´æ–°ç»Ÿè®¡                                                â”‚        â”‚
â”‚  â”‚    - åˆ†é’Ÿçº§ç»Ÿè®¡ (summary-minute, 30å¤©)                     â”‚        â”‚
â”‚  â”‚    - æ¯æ—¥ç»Ÿè®¡ (summary, é•¿æœŸ)                              â”‚        â”‚
â”‚  â”‚    - åˆ†ç»„ç»Ÿè®¡ (groupsummary)                               â”‚        â”‚
â”‚  â”‚ 5. è§¦å‘å‘Šè­¦                                                â”‚        â”‚
â”‚  â”‚    - ä½™é¢å‘Šè­¦ (Balance Alert)                              â”‚        â”‚
â”‚  â”‚    - ä½¿ç”¨å‘Šè­¦ (Usage Alert)                                â”‚        â”‚
â”‚  â”‚    - é£ä¹¦é€šçŸ¥ (Feishu Webhook)                             â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Cache Layer (åŒå±‚ç¼“å­˜)                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚   Redis (åˆ†å¸ƒå¼)       â”‚  â”‚   Memory (æœ¬åœ°)        â”‚               â”‚
â”‚  â”‚ - TokenCache           â”‚  â”‚ - TokenCache           â”‚               â”‚
â”‚  â”‚ - GroupCache           â”‚  â”‚ - GroupCache           â”‚               â”‚
â”‚  â”‚ - ModelConfigCache     â”‚  â”‚ - ModelConfigCache     â”‚               â”‚
â”‚  â”‚ - MCPCache             â”‚  â”‚ - MCPCache             â”‚               â”‚
â”‚  â”‚ åŒæ­¥å‘¨æœŸ: 10ç§’          â”‚  â”‚ è¯»å–ä¼˜å…ˆ: å†…å­˜â†’Redis   â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Data Persistence                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚  Main Database      â”‚  â”‚  Log Database       â”‚                     â”‚
â”‚  â”‚  (PostgreSQLä¼˜å…ˆ)   â”‚  â”‚  (å¯é€‰åˆ†ç¦»)          â”‚                     â”‚
â”‚  â”‚ - channels          â”‚  â”‚ - logs              â”‚                     â”‚
â”‚  â”‚ - tokens            â”‚  â”‚ - summary           â”‚                     â”‚
â”‚  â”‚ - groups            â”‚  â”‚ - summary_minute    â”‚                     â”‚
â”‚  â”‚ - model_configs     â”‚  â”‚ - groupsummary      â”‚                     â”‚
â”‚  â”‚ - mcps              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒè®¾è®¡ç†å¿µ

- **é€‚é…å™¨æ¨¡å¼**: 40+ AI æä¾›å•†ç»Ÿä¸€æ¥å£æŠ½è±¡
- **è£…é¥°å™¨æ¨¡å¼**: æ’ä»¶é“¾çµæ´»å¢å¼ºåŠŸèƒ½
- **åŒå±‚ç¼“å­˜**: Redis + å†…å­˜æå‡æ€§èƒ½
- **å…ƒæ•°æ®é©±åŠ¨**: çµæ´»çš„è¯·æ±‚å¤„ç†ä¸Šä¸‹æ–‡
- **å¼‚æ­¥æ‰¹å¤„ç†**: é«˜æ•ˆçš„ç»Ÿè®¡æ•°æ®å¤„ç†

---

## ğŸ¯ æ ¸å¿ƒç»„ä»¶

### 1. Adaptor æ¥å£ï¼ˆé€‚é…å™¨ï¼‰

ç»Ÿä¸€çš„ AI æä¾›å•†æ¥å£æŠ½è±¡ï¼Œæ”¯æŒ 40+ æä¾›å•†ï¼š

```go
type Adaptor interface {
    Metadata() Metadata
    SupportMode(mode Mode) bool
    DefaultBaseURL() string
    GetRequestURL(meta, store, context) RequestURL
    SetupRequestHeader(meta, store, context, req)
    ConvertRequest(meta, store, req) ConvertResult
    DoRequest(meta, store, context, req) *http.Response
    DoResponse(meta, store, context, resp) (Usage, Error)
}
```

**æ”¯æŒçš„æä¾›å•†åˆ†ç±»ï¼š**

| ç±»å‹ | æä¾›å•†åˆ—è¡¨ |
|------|-----------|
| **å›½é™…ä¸»æµ** | OpenAI, Azure OpenAI, Anthropic Claude, Google Gemini, Vertex AI, AWS Bedrock, Mistral, Cohere, Groq |
| **å›½å†…ä¸»æµ** | é˜¿é‡Œé€šä¹‰, ç™¾åº¦æ–‡å¿ƒ, è…¾è®¯æ··å…ƒ, è®¯é£æ˜Ÿç«, æ™ºè°± GLM, Deepseek, æœˆä¹‹æš—é¢ Moonshot, è±†åŒ… Coze |
| **å…¶ä»–** | OpenRouter, Cloudflare AI, Together AI, Perplexity, AI360, Novita, Jina, SiliconFlow |

**æ”¯æŒçš„æ¨¡å¼ï¼š**
- ChatCompletions (èŠå¤©)
- Completions (æ–‡æœ¬ç”Ÿæˆ)
- Embeddings (å‘é‡åµŒå…¥)
- Images (å›¾åƒç”Ÿæˆ/ç¼–è¾‘)
- Audio (STT/TTS)
- Video (è§†é¢‘ç”Ÿæˆ)
- Rerank (é‡æ’åº)
- Moderation (å†…å®¹å®¡æ ¸)
- Anthropic Messages (Claude ä¸“å±)
- Gemini API (Google ä¸“å±)
- OpenAI Responses API (æ–°åè®®)

### 2. Plugin Systemï¼ˆæ’ä»¶ç³»ç»Ÿï¼‰

åŸºäºè£…é¥°å™¨æ¨¡å¼çš„æ’ä»¶é“¾ï¼Œçµæ´»ç»„åˆåŠŸèƒ½ï¼š

```go
adaptor = WrapperAdaptor(adaptor,
    CachePlugin,        // ç¼“å­˜å±‚
    WebSearchPlugin,    // ç½‘ç»œæœç´¢
    ThinkSplitPlugin,   // æ€ç»´åˆ†å‰²
    PatchPlugin,        // è¯·æ±‚ä¿®å¤
    MonitorPlugin,      // ç›‘æ§åŸ‹ç‚¹
)
```

**å¯ç”¨æ’ä»¶ï¼š**

#### Cache Pluginï¼ˆç¼“å­˜æ’ä»¶ï¼‰
- Redis + å†…å­˜åŒå±‚å­˜å‚¨
- åŸºäºè¯·æ±‚å†…å®¹çš„ SHA256 å“ˆå¸Œé”®
- å¯é…ç½® TTL å’Œå¤§å°é™åˆ¶
- æ”¯æŒæµå¼å’Œéæµå¼å“åº”ç¼“å­˜

#### WebSearch Pluginï¼ˆç½‘ç»œæœç´¢æ’ä»¶ï¼‰
- æ”¯æŒ Googleã€Bingã€Arxiv
- AI é©±åŠ¨çš„æŸ¥è¯¢é‡å†™
- è‡ªåŠ¨å¼•ç”¨æ ¼å¼åŒ–
- ç”¨æˆ·å¯æ§æœç´¢æ·±åº¦

#### ThinkSplit Pluginï¼ˆæ€ç»´åˆ†å‰²æ’ä»¶ï¼‰
- è‡ªåŠ¨è¯†åˆ« `<think>...</think>` æ ‡ç­¾
- æå–æ€è€ƒå†…å®¹åˆ° `reasoning_content` å­—æ®µ
- æ”¯æŒæµå¼å’Œéæµå¼å“åº”
- é€‚é…æ¨ç†æ¨¡å‹ï¼ˆå¦‚ O1/O3ï¼‰

#### StreamFake Pluginï¼ˆæµå¼ä¼ªé€ æ’ä»¶ï¼‰
- é¿å…éæµå¼è¯·æ±‚è¶…æ—¶
- é€šè¿‡å†…éƒ¨æµå¼ä¼ è¾“ä¿æŒè¿æ¥
- é€æ˜è½¬æ¢ï¼Œå¯¹å®¢æˆ·ç«¯æ— æ„ŸçŸ¥
- è‡ªåŠ¨é‡ç»„å®Œæ•´å“åº”

#### Monitor Pluginï¼ˆç›‘æ§æ’ä»¶ï¼‰
- è¯·æ±‚å»¶è¿Ÿç›‘æ§
- é”™è¯¯ç‡ç»Ÿè®¡
- Token ä½¿ç”¨é‡è¿½è¸ª
- æ€§èƒ½åŸ‹ç‚¹

### 3. Meta Contextï¼ˆå…ƒæ•°æ®ä¸Šä¸‹æ–‡ï¼‰

è¯·æ±‚å¤„ç†çš„æ ¸å¿ƒä¸Šä¸‹æ–‡å¯¹è±¡ï¼š

```go
type Meta struct {
    Channel        ChannelMeta      // é€šé“ä¿¡æ¯
    Group          GroupCache       // ç»„ç»‡ä¿¡æ¯
    Token          TokenCache       // ä»¤ç‰Œä¿¡æ¯
    ModelConfig    ModelConfig      // æ¨¡å‹é…ç½®
    RequestID      string           // è¯·æ±‚ ID
    Endpoint       string           // ç«¯ç‚¹
    Mode           mode.Mode        // æ¨¡å¼
    OriginModel    string           // åŸå§‹æ¨¡å‹å
    ActualModel    string           // å®é™…æ¨¡å‹å
    RequestTimeout time.Duration    // è¯·æ±‚è¶…æ—¶
    RequestAt      time.Time        // è¯·æ±‚æ—¶é—´
}
```

### 4. ä¸­é—´ä»¶é“¾

**è¯·æ±‚å¤„ç†ä¸­é—´ä»¶ï¼š**

1. **IPBlock**: IP é»‘åå•æ£€æŸ¥
2. **TokenAuth**: Token è®¤è¯ + é…é¢æ£€æŸ¥ + IP é™åˆ¶
3. **Distributor**: è‡ªåŠ¨åˆ†é…é€šé“ï¼ˆè´Ÿè½½å‡è¡¡ï¼‰
4. **RequestID**: ç”Ÿæˆå”¯ä¸€è¯·æ±‚ ID
5. **CORS**: è·¨åŸŸå¤„ç†
6. **Log**: æ—¥å¿—è®°å½•
7. **Recover**: å¼‚å¸¸æ¢å¤

### 5. åŒå±‚ç¼“å­˜ç³»ç»Ÿ

**ç¼“å­˜æ¶æ„ï¼š**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Application Layer                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Memory Cache (æœ¬åœ°)                        â”‚
â”‚  - è¯»å–ä¼˜å…ˆ                                  â”‚
â”‚  - 10ç§’åŒæ­¥å‘¨æœŸ                              â”‚
â”‚  - çƒ­ç‚¹æ•°æ®ç¼“å­˜                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Redis Cache (åˆ†å¸ƒå¼)                       â”‚
â”‚  - è·¨å®ä¾‹å…±äº«                                â”‚
â”‚  - æŒä¹…åŒ–å­˜å‚¨                                â”‚
â”‚  - ä¸»æ•°æ®æº                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç¼“å­˜å†…å®¹ï¼š**
- TokenCache: ä»¤ç‰Œä¿¡æ¯
- GroupCache: ç»„ç»‡é…ç½®
- ModelConfigCache: æ¨¡å‹ä»·æ ¼é…ç½®
- MCPCache: MCP æœåŠ¡å™¨é…ç½®

### 6. è®¡è´¹ç³»ç»Ÿ

**å¤šå±‚å®šä»·ç­–ç•¥ï¼š**

```go
// 1. åŸºç¡€ä»·æ ¼
inputPrice := modelConfig.InputPrice
outputPrice := modelConfig.OutputPrice

// 2. åˆ†ç»„å®šä»·è¦†ç›–
if groupModelConfig := model.GetGroupModelConfig(groupID, modelName); groupModelConfig != nil {
    if groupModelConfig.InputPrice > 0 {
        inputPrice = groupModelConfig.InputPrice
    }
    if groupModelConfig.OutputPrice > 0 {
        outputPrice = groupModelConfig.OutputPrice
    }
}

// 3. ç¼“å­˜ Token ä¼˜æƒ 
cachedInputCost := usage.CachedInputTokens * inputPrice * cacheDiscount

// 4. æ¨ç† Token åŠ ä»·
reasoningCost := usage.ReasoningTokens * outputPrice * reasoningMultiplier

// 5. æ€»æˆæœ¬
totalCost := (usage.InputTokens * inputPrice) +
             (usage.OutputTokens * outputPrice) +
             cachedInputCost +
             reasoningCost
```

**ç»Ÿè®¡ç»´åº¦ï¼š**
- åˆ†é’Ÿçº§ç»Ÿè®¡ï¼ˆä¿ç•™ 30 å¤©ï¼‰
- æ¯æ—¥ç»Ÿè®¡ï¼ˆé•¿æœŸä¿ç•™ï¼‰
- åˆ†ç»„ç»Ÿè®¡ï¼ˆå¤šç§Ÿæˆ·éš”ç¦»ï¼‰

---

## ğŸ’¡ æ ¸å¿ƒç‰¹æ€§

### è®¤è¯ä¸æˆæƒ

| åŠŸèƒ½ | è¯´æ˜ |
|------|------|
| **Token è®¤è¯** | æ”¯æŒå¤šç§å¤´éƒ¨æ ¼å¼ï¼ˆAuthorization, api-key, x-api-keyï¼‰ |
| **IP é™åˆ¶** | æ”¯æŒå­ç½‘ CIDR æ ¼å¼çš„ IP ç™½åå• |
| **æ¨¡å‹ç™½åå•** | Token çº§åˆ«çš„æ¨¡å‹è®¿é—®æ§åˆ¶ |
| **é…é¢ç®¡ç†** | æ€»é¢åº¦ + å‘¨æœŸé¢åº¦ï¼ˆæ—¥/å‘¨/æœˆï¼‰ |
| **ç®¡ç†å‘˜è®¤è¯** | å…¨å±€ ADMIN_KEY |
| **å¤šç§Ÿæˆ·** | ç»„ç»‡ï¼ˆGroupï¼‰çº§åˆ«éš”ç¦» |

### è´Ÿè½½å‡è¡¡ä¸é«˜å¯ç”¨

| åŠŸèƒ½ | è¯´æ˜ |
|------|------|
| **é€šé“é€‰æ‹©ç­–ç•¥** | è½®è¯¢ã€éšæœºã€ä¼˜å…ˆçº§ã€é”™è¯¯ç‡ |
| **è‡ªåŠ¨é‡è¯•** | å¯é…ç½®é‡è¯•æ¬¡æ•° |
| **å¥åº·æ£€æŸ¥** | ä½™é¢æŸ¥è¯¢ + è‡ªåŠ¨ç¦ç”¨å¤±è´¥é€šé“ |
| **æ•…éšœè½¬ç§»** | è‡ªåŠ¨åˆ‡æ¢åˆ°å¯ç”¨é€šé“ |

### MCP (Model Context Protocol) æ”¯æŒ

- **å…¬å…± MCP æœåŠ¡å™¨**: ç¤¾åŒºç»´æŠ¤çš„é›†æˆ
- **ç»„ç»‡ MCP æœåŠ¡å™¨**: ç§æœ‰ç»„ç»‡å·¥å…·
- **åµŒå…¥å¼ MCP**: å†…ç½®åŠŸèƒ½ï¼Œæ˜“äºé…ç½®
- **OpenAPI è½¬ MCP**: ä» API è§„èŒƒè‡ªåŠ¨ç”Ÿæˆå·¥å…·

### ç›‘æ§ä¸å‘Šè­¦

| åŠŸèƒ½ | è¯´æ˜ |
|------|------|
| **å®æ—¶å‘Šè­¦** | ä½™é¢å‘Šè­¦ã€ä½¿ç”¨å‘Šè­¦ã€é”™è¯¯ç‡å‘Šè­¦ |
| **è¯¦ç»†æ—¥å¿—** | å®Œæ•´çš„è¯·æ±‚/å“åº”è¿½è¸ª |
| **é«˜çº§åˆ†æ** | è¯·æ±‚é‡ã€é”™è¯¯ç»Ÿè®¡ã€RPM/TPM æŒ‡æ ‡ã€æˆæœ¬åˆ†æ |
| **é€šé“æ€§èƒ½** | é”™è¯¯ç‡åˆ†æå’Œæ€§èƒ½ç›‘æ§ |
| **é£ä¹¦é›†æˆ** | æ”¯æŒé£ä¹¦ Webhook é€šçŸ¥ |

---

## ğŸš€ è¯·æ±‚å¤„ç†æµç¨‹

```
Client Request
    â†“
[Router] /v1/chat/completions
    â†“
[Middleware Chain]
â”œâ”€ IPBlock (IP é»‘åå•æ£€æŸ¥)
â”œâ”€ TokenAuth (Token è®¤è¯ + é…é¢æ£€æŸ¥ + IP é™åˆ¶)
â”œâ”€ Distributor (è‡ªåŠ¨åˆ†é…é€šé“)
â”œâ”€ RequestID (ç”Ÿæˆè¯·æ±‚ ID)
â”œâ”€ CORS (è·¨åŸŸå¤„ç†)
â””â”€ Log (æ—¥å¿—è®°å½•)
    â†“
[Controller] NewRelay(ChatCompletions)
    â†“
[Meta Builder] æ„å»ºè¯·æ±‚ä¸Šä¸‹æ–‡
â”œâ”€ Channel (é€šé“ä¿¡æ¯)
â”œâ”€ Group (ç»„ç»‡ä¿¡æ¯)
â”œâ”€ Token (ä»¤ç‰Œä¿¡æ¯)
â”œâ”€ ModelConfig (æ¨¡å‹é…ç½®)
â”œâ”€ RequestID, Endpoint, Mode
â””â”€ OriginModel, ActualModel
    â†“
[Adaptor Selection] GetAdaptor(channel.Type)
    â†“
[Plugin Wrapper] WrapperAdaptor(adaptor, plugins...)
â”œâ”€ CachePlugin (ç¼“å­˜å±‚)
â”œâ”€ WebSearchPlugin (ç½‘ç»œæœç´¢)
â”œâ”€ ThinkSplitPlugin (æ€ç»´åˆ†å‰²)
â”œâ”€ PatchPlugin (è¯·æ±‚ä¿®å¤)
â””â”€ MonitorPlugin (ç›‘æ§åŸ‹ç‚¹)
    â†“
[Adaptor Processing]
â”œâ”€ GetRequestURL() â†’ https://api.openai.com/...
â”œâ”€ SetupRequestHeader() â†’ Authorization: Bearer ...
â”œâ”€ ConvertRequest() â†’ è½¬æ¢ä¸ºç›®æ ‡æ ¼å¼
â”œâ”€ DoRequest() â†’ HTTP è¯·æ±‚
â””â”€ DoResponse() â†’ è§£æå“åº” + Token è®¡ç®—
    â†“
[Response Render]
â”œâ”€ Stream: OpenaiSSE / ClaudeEvent / GeminiSSE
â””â”€ Non-Stream: JSON
    â†“
[Usage Tracking]
â”œâ”€ è®°å½• Log (GORM)
â”œâ”€ æ›´æ–° Summary (åˆ†é’Ÿçº§ + æ¯æ—¥)
â”œâ”€ è®¡ç®—æˆæœ¬ (åŸºç¡€ä»·æ ¼ + åˆ†ç»„å®šä»· + ç¼“å­˜ä¼˜æƒ )
â””â”€ è§¦å‘å‘Šè­¦ (ä½™é¢ < threshold)
    â†“
Response to Client
```

---

## ğŸ”§ æŠ€æœ¯æ ˆ

### åç«¯æŠ€æœ¯

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| **Go** | 1.25.5 | æ ¸å¿ƒå¼€å‘è¯­è¨€ |
| **Gin** | Latest | Web æ¡†æ¶ |
| **GORM** | Latest | ORM æ¡†æ¶ |
| **Redis** | 6.0+ | åˆ†å¸ƒå¼ç¼“å­˜ |
| **PostgreSQL** | 12+ | ä¸»æ•°æ®åº“ï¼ˆæ¨èï¼‰ |
| **SQLite** | 3.x | è½»é‡çº§æ•°æ®åº“ï¼ˆå¯é€‰ï¼‰ |

### å‰ç«¯æŠ€æœ¯

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| **React** | 18.x | UI æ¡†æ¶ |
| **Vite** | Latest | æ„å»ºå·¥å…· |
| **TypeScript** | Latest | ç±»å‹ç³»ç»Ÿ |

### éƒ¨ç½²æŠ€æœ¯

| æŠ€æœ¯ | è¯´æ˜ |
|------|------|
| **Docker** | å®¹å™¨åŒ–éƒ¨ç½² |
| **Kubernetes** | å®¹å™¨ç¼–æ’ |
| **Docker Compose** | æœ¬åœ°å¼€å‘ç¯å¢ƒ |

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
aiproxy/
â”œâ”€â”€ core/                      # åç«¯æ ¸å¿ƒä»£ç 
â”‚   â”œâ”€â”€ relay/                 # è¯·æ±‚è½¬å‘æ ¸å¿ƒ
â”‚   â”‚   â”œâ”€â”€ adaptor/           # 40+ AI æä¾›å•†é€‚é…å™¨
â”‚   â”‚   â”œâ”€â”€ plugin/            # æ’ä»¶ç³»ç»Ÿ
â”‚   â”‚   â”‚   â”œâ”€â”€ cache/         # ç¼“å­˜æ’ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ web-search/    # ç½‘ç»œæœç´¢æ’ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ thinksplit/    # æ€ç»´åˆ†å‰²æ’ä»¶
â”‚   â”‚   â”‚   â””â”€â”€ streamfake/    # æµå¼ä¼ªé€ æ’ä»¶
â”‚   â”‚   â””â”€â”€ middleware/        # ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ model/                 # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ controller/            # API æ§åˆ¶å™¨
â”‚   â””â”€â”€ common/                # å…¬å…±ç»„ä»¶
â”œâ”€â”€ web/                       # å‰ç«¯ä»£ç 
â”‚   â”œâ”€â”€ src/                   # æºä»£ç 
â”‚   â””â”€â”€ dist/                  # æ„å»ºäº§ç‰©
â”œâ”€â”€ mcp-servers/               # MCP æœåŠ¡å™¨
â”œâ”€â”€ openapi-mcp/               # OpenAPI è½¬ MCP
â”œâ”€â”€ scripts/                   # è„šæœ¬å·¥å…·
â”œâ”€â”€ docker-compose.yaml        # Docker Compose é…ç½®
â””â”€â”€ Dockerfile                 # Docker é•œåƒæ„å»º
```

---

## ğŸ¯ æ ¸å¿ƒä¼˜åŠ¿

### 1. ä»£ç ä¼˜é›…

- **é€‚é…å™¨æ¨¡å¼**: æ¸…æ™°çš„æä¾›å•†æŠ½è±¡ï¼Œæ˜“äºæ‰©å±•
- **è£…é¥°å™¨æ¨¡å¼**: çµæ´»çš„æ’ä»¶ç³»ç»Ÿï¼ŒåŠŸèƒ½å¯ç»„åˆ
- **å…ƒæ•°æ®é©±åŠ¨**: ç»Ÿä¸€çš„è¯·æ±‚ä¸Šä¸‹æ–‡ç®¡ç†
- **ç®¡é“å¼å¤„ç†**: çº¿æ€§æµç¨‹ï¼Œæ˜“äºè¿½è¸ªå’Œè°ƒè¯•

### 2. æ€§èƒ½ä¼˜å¼‚

- **åŒå±‚ç¼“å­˜**: Redis + å†…å­˜ï¼Œ10ç§’åŒæ­¥å‘¨æœŸ
- **è¯·æ±‚çº§ç¼“å­˜**: å®Œæ•´çš„è¯·æ±‚/å“åº”ç¼“å­˜æ”¯æŒ
- **ç›´æ¥å¤„ç†**: æ— åå°„ï¼Œæ— é¢å¤–æŠ½è±¡å±‚
- **å¼‚æ­¥æ‰¹å¤„ç†**: é«˜æ•ˆçš„ç»Ÿè®¡æ•°æ®å¤„ç†

### 3. åŠŸèƒ½ä¸°å¯Œ

- **40+ AI æä¾›å•†**: è¦†ç›–ä¸»æµå›½å†…å¤– AI æœåŠ¡
- **å®Œæ•´çš„æ’ä»¶ç³»ç»Ÿ**: ç¼“å­˜ã€æœç´¢ã€æ€ç»´åˆ†å‰²ã€ç›‘æ§ç­‰
- **MCP æ”¯æŒ**: å…¬å…±ã€ç»„ç»‡ã€åµŒå…¥å¼ä¸‰ç§æ¨¡å¼
- **å¤šæ¨¡æ€æ”¯æŒ**: æ–‡æœ¬ã€å›¾åƒã€éŸ³é¢‘ã€è§†é¢‘å…¨è¦†ç›–
- **åè®®è½¬æ¢**: æ”¯æŒ OpenAIã€Claudeã€Gemini ç­‰å¤šç§åè®®

### 4. æ˜“äºä½¿ç”¨

- **å•äºŒè¿›åˆ¶éƒ¨ç½²**: ä¸€ä¸ªæ–‡ä»¶å³å¯è¿è¡Œ
- **é…ç½®ç®€å•**: ä¸»è¦é€šè¿‡ç¯å¢ƒå˜é‡é…ç½®
- **å¼€å‘å‹å¥½**: æ¸…æ™°çš„ä»£ç ç»“æ„ï¼Œå®Œå–„çš„æ–‡æ¡£
- **å­¦ä¹ æ›²çº¿ä½**: é€‚é…å™¨æ¨¡å¼ç®€å•æ˜“æ‡‚

### 5. ä¼ä¸šçº§ç‰¹æ€§

- **å¤šç§Ÿæˆ·**: ç»„ç»‡çº§åˆ«çš„å®Œå…¨éš”ç¦»
- **è®¿é—®æ§åˆ¶**: Token è®¤è¯ + IP é™åˆ¶ + æ¨¡å‹ç™½åå•
- **é…é¢ç®¡ç†**: çµæ´»çš„é¢åº¦å’Œé€Ÿç‡é™åˆ¶
- **è‡ªå®šä¹‰å®šä»·**: åˆ†ç»„çº§åˆ«çš„æ¨¡å‹å®šä»·
- **å®Œå–„ç›‘æ§**: å®æ—¶å‘Šè­¦ + è¯¦ç»†æ—¥å¿— + æ€§èƒ½åˆ†æ

---

## ğŸ“Š ä½¿ç”¨åœºæ™¯

### 1. AI åº”ç”¨ç½‘å…³

ä½œä¸ºç»Ÿä¸€çš„ AI æœåŠ¡å…¥å£ï¼Œæ”¯æŒå¤šç§ AI æä¾›å•†ï¼š
- ç»Ÿä¸€ OpenAI å…¼å®¹æ¥å£
- è‡ªåŠ¨è´Ÿè½½å‡è¡¡å’Œæ•…éšœè½¬ç§»
- ç»Ÿä¸€çš„è®¤è¯å’Œè®¡è´¹

### 2. å¤šç§Ÿæˆ· SaaS å¹³å°

ä¸ºå¤šä¸ªç»„ç»‡æä¾› AI æœåŠ¡ï¼š
- å®Œå…¨çš„æ•°æ®éš”ç¦»
- ç‹¬ç«‹çš„é…é¢å’Œå®šä»·
- çµæ´»çš„è®¿é—®æ§åˆ¶

### 3. AI å¼€å‘å¹³å°

é›†æˆåˆ° AI å¼€å‘å·¥å…·ä¸­ï¼š
- FastGPT é›†æˆ
- Claude Code é›†æˆ
- Gemini CLI é›†æˆ
- Codex é›†æˆ

### 4. ä¼ä¸š AI ä¸­å°

ä½œä¸ºä¼ä¸šå†…éƒ¨çš„ AI æœåŠ¡ä¸­å°ï¼š
- ç»Ÿä¸€çš„ AI æœåŠ¡ç®¡ç†
- æˆæœ¬æ§åˆ¶å’Œåˆ†æ‘Š
- ä½¿ç”¨ç›‘æ§å’Œå®¡è®¡

---

## ğŸ”— ç›¸å…³èµ„æº

- **GitHub**: https://github.com/labring/aiproxy
- **æ–‡æ¡£**: [README.md](./README.md)
- **é…ç½®æ–‡æ¡£**: [config.md](./config.md)
- **æ’ä»¶æ–‡æ¡£**:
  - [Cache Plugin](./core/relay/plugin/cache/README.md)
  - [WebSearch Plugin](./core/relay/plugin/web-search/README.md)
  - [ThinkSplit Plugin](./core/relay/plugin/thinksplit/README.md)
  - [StreamFake Plugin](./core/relay/plugin/streamfake/README.md)

---

## ğŸ“ æ€»ç»“

AI Proxy æ˜¯ä¸€ä¸ª**æ€§èƒ½ä¼˜å…ˆã€æ’ä»¶åŒ–ã€æ˜“äºä½¿ç”¨**çš„ä¼ä¸šçº§ AI ç½‘å…³ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

- **æ¶æ„ä¼˜é›…**: é€‚é…å™¨ + è£…é¥°å™¨æ¨¡å¼ï¼Œæ¸…æ™°ä¸”å¯æ‰©å±•
- **æ€§èƒ½å“è¶Š**: åŒå±‚ç¼“å­˜ã€ç®¡é“å¼å¤„ç†ã€ç›´æ¥è½¬å‘
- **åŠŸèƒ½å®Œæ•´**: 40+ æä¾›å•†ã€å®Œæ•´æ’ä»¶ç³»ç»Ÿã€MCP æ”¯æŒ
- **éƒ¨ç½²ç®€å•**: å•äºŒè¿›åˆ¶ã€é…ç½®ç®€å•ã€å¼€ç®±å³ç”¨
- **ä¼ä¸šå°±ç»ª**: å¤šç§Ÿæˆ·ã€è®¿é—®æ§åˆ¶ã€ç›‘æ§å‘Šè­¦ã€æˆæœ¬ç®¡ç†

é€‚ç”¨äºéœ€è¦**é«˜æ€§èƒ½ã€é«˜å¯é ã€æ˜“æ‰©å±•**çš„ AI åº”ç”¨åœºæ™¯ã€‚
