# ========================================
# AI Proxy 环境变量配置
# ========================================
# 复制此文件为 .env 并根据需要修改
# 优先级：环境变量 > .env 文件 > 配置文件 > 数据库


# ========================================
# 核心配置 (必需)
# ========================================

# 管理员 API Key（必需，用于管理后台和 API 认证）
ADMIN_KEY=aiproxy-local-dev

# 监听地址（可选，默认: 0.0.0.0:3000）
# LISTEN=0.0.0.0:3000


# ========================================
# 数据库配置
# ========================================

# 主数据库连接
# 支持: PostgreSQL, MySQL, SQLite
# PostgreSQL: postgres://user:pass@host:5432/dbname?sslmode=disable
# MySQL: root:password@tcp(host:3306)/dbname?charset=utf8mb4&parseTime=True&loc=Local
#        或 mysql://root:password@tcp(host:3306)/dbname?charset=utf8mb4&parseTime=True&loc=Local
# SQLite: aiproxy.db (默认，如果 SQL_DSN 未设置)
SQL_DSN=root:password@tcp(localhost:3306)/aiproxy?charset=utf8mb4&parseTime=True&loc=Local

# 日志数据库连接（可选，用于分离日志数据）
# 如果不设置，日志将存储在主数据库中
# 格式同 SQL_DSN，支持 PostgreSQL, MySQL, SQLite
# LOG_SQL_DSN=root:password@tcp(localhost:3306)/aiproxy_log?charset=utf8mb4&parseTime=True&loc=Local

# 禁用自动数据库迁移（可选，默认: false）
# DISABLE_AUTO_MIGRATE_DB=false

# SQLite 相关配置（仅在使用 SQLite 时有效）
# SQLITE_PATH=aiproxy.db
# SQLITE_BUSY_TIMEOUT=3000


# ========================================
# 缓存配置
# ========================================

# Redis 连接（可选，用于分布式缓存）
# 格式: redis://host:port/db?password=xxx
REDIS=redis://localhost:6379

# Redis Key 前缀（可选，默认: aiproxy）
# REDIS_KEY_PREFIX=aiproxy


# ========================================
# 开发调试配置
# ========================================

# 调试模式（启用详细日志）
DEBUG=true

# SQL 调试（打印所有 SQL 语句）
# DEBUG_SQL=true

# 时区设置
TZ=Asia/Shanghai


# ========================================
# 日志配置
# ========================================

# 主日志保留时间（小时，0 表示不限制）
# 默认: 168 (7天)
LOG_STORAGE_HOURS=168

# 重试日志保留时间（小时，0 表示不限制）
# 默认: 72 (3天)
RETRY_LOG_STORAGE_HOURS=72

# 详细日志保留时间（小时）
# 默认: 72 (3天)
LOG_DETAIL_STORAGE_HOURS=24

# 保存所有请求详情（包括请求和响应 body）
# 默认: false（仅保存失败请求）
SAVE_ALL_LOG_DETAIL=true

# 请求 Body 最大记录大小（字节）
# 默认: 8192 (8KB)
LOG_DETAIL_REQUEST_BODY_MAX_SIZE=10000

# 响应 Body 最大记录大小（字节）
# 默认: 8192 (8KB)
LOG_DETAIL_RESPONSE_BODY_MAX_SIZE=10000

# 日志清理批次大小
# 默认: 10000
CLEAN_LOG_BATCH_SIZE=5000


# ========================================
# 功能开关
# ========================================

# 计费功能（可选，默认: true）
# BILLING_ENABLED=true

# 禁用服务（维护模式，默认: false）
# DISABLE_SERVE=false

# 禁用 Web 管理后台（默认: false）
# DISABLE_WEB=false

# Web 静态文件路径（可选）
# WEB_PATH=/path/to/web/dist

# 禁用模型配置（默认: false）
# DISABLE_MODEL_CONFIG=false

# 启用 FFmpeg（用于音频处理，默认: false）
# FFMPEG_ENABLED=false


# ========================================
# 安全配置
# ========================================

# 内部 Token（用于内部服务间调用）
# INTERNAL_TOKEN=your-internal-token

# IP 分组阈值（每分钟请求数，用于检测异常行为）
# 默认: 100
IP_GROUPS_THRESHOLD=100

# IP 分组封禁阈值
# 默认: 200
IP_GROUPS_BAN_THRESHOLD=200


# ========================================
# 重试与限流配置
# ========================================

# 默认重试次数
# 默认: 3
RETRY_TIMES=3

# 模糊 Token 计算阈值（字符数）
# 当文本长度超过此值时，使用近似计算（长度/4）
# 设为 0 始终精确计算（默认）
# 默认: 0
FUZZY_TOKEN_THRESHOLD=240000


# ========================================
# 配额与计费配置
# ========================================

# 组织最大 Token 数量（0 表示无限制）
# 默认: 0
GROUP_MAX_TOKEN_NUM=0

# 组织消费等级比例（JSON 格式）
# 例如: {"1":1,"2":0.9,"3":0.8} 表示等级1按原价，等级2打9折，等级3打8折
# 默认: {}
GROUP_CONSUME_LEVEL_RATIO={"1":1,"2":0.9,"3":0.8}


# ========================================
# 告警配置
# ========================================

# 默认错误率告警阈值（0-1之间）
# 默认: 0.5 (50%)
DEFAULT_WARN_NOTIFY_ERROR_RATE=0.5

# 使用量告警阈值（单位：美元或配额）
# 0 表示禁用，默认: 0
USAGE_ALERT_THRESHOLD=100

# 使用量告警最小平均阈值（前三天平均用量）
# 0 表示无限制，默认: 0
USAGE_ALERT_MIN_AVG_THRESHOLD=10

# 使用量告警白名单（JSON 数组，组织 ID 列表）
# USAGE_ALERT_WHITELIST=["group1","group2"]

# 飞书 Webhook（用于发送告警通知）
# NOTIFY_FEISHU_WEBHOOK=https://open.feishu.cn/open-apis/bot/v2/hook/xxxxx

# 通知备注（附加在通知消息中）
# NOTIFY_NOTE=生产环境告警


# ========================================
# Sealos 集成配置（可选）
# ========================================

# Sealos JWT Key（用于 Sealos 平台集成）
# SEALOS_JWT_KEY=your-sealos-jwt-key

# Sealos 账户服务 URL
# 默认: http://account-service.account-system.svc.cluster.local:2333
# SEALOS_ACCOUNT_URL=http://account-service.account-system.svc.cluster.local:2333

# Sealos 实名认证检查（默认: false）
# BALANCE_SEALOS_CHECK_REAL_NAME_ENABLE=false

# Sealos 未实名用户使用额度限制（美元）
# 默认: 1.0
# BALANCE_SEALOS_NO_REAL_NAME_USED_AMOUNT_LIMIT=1.0


# ========================================
# MCP (Model Context Protocol) 配置
# ========================================

# 默认 MCP Host
# DEFAULT_MCP_HOST=http://localhost:8080

# 公共 MCP Host
# PUBLIC_MCP_HOST=http://public-mcp.example.com

# 分组 MCP Host
# GROUP_MCP_HOST=http://group-mcp.example.com


# ========================================
# 高级配置
# ========================================

# 配置文件路径（YAML 格式）
# 默认: ./config.yaml
CONFIG_FILE_PATH=./config.yaml

# 默认通道模型列表（JSON 格式）
# 例如: {"1":["gpt-4","gpt-3.5-turbo"],"2":["claude-3-opus"]}
# DEFAULT_CHANNEL_MODELS={}

# 默认通道模型映射（JSON 格式）
# 例如: {"1":{"gpt-4":"gpt-4-0613"},"2":{"claude-3":"claude-3-opus"}}
# DEFAULT_CHANNEL_MODEL_MAPPING={}


# ========================================
# 说明
# ========================================
# 1. 以 # 开头的行为注释
# 2. 优先级：环境变量 > .env 文件 > 配置文件 > 数据库
# 3. 应用会自动加载以下文件（按顺序）：
#    - .env
#    - .env.local
#    - .env.aiproxy.local
# 4. 如果 ADMIN_KEY 未设置，应用会自动生成并保存到 .env.aiproxy.local
# 5. 详细配置说明请查看: config.md
